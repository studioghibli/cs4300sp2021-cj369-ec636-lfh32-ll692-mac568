<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <title>Game Recommendations</title>
    <link rel="stylesheet" href="/static/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
</head>
<body style="padding:0px">
    <div class="navbar navbar-default navbar-fixed-bottom" role="navigation">
        <div class="container">
            <p class="navbar-text">Built by: cj369, ec636, lfh32, ll692, mac568</p>
        </div>
    </div>
    <!-- Slideshow -->
    <div class="slideshow-container" style="padding:0%; position: static;">
        <!-- Full-width images with number and caption text -->
        <img
            class="mySlides"
            src="{{ url_for('static', filename='img/p1.jpeg') }}"
            alt="slideshow2"
            style="width: 100%; height: 100%; filter: brightness(80%);"
        >
        <img
            class="mySlides"
            src="{{ url_for('static', filename='img/p2.jpeg') }}"
            alt="slideshow3"
            style="width: 100%; height: 100%; filter: brightness(80%);"
        >
        <img
            class="mySlides"
            src="{{ url_for('static', filename='img/p3.jpeg') }}"
            alt="slideshow4"
            style="width: 100%; height: 100%; filter: brightness(80%);"
        >
        <img
            class="mySlides"
            src="{{ url_for('static', filename='img/p4.jpeg') }}"
            alt="slideshow5"
            style="width: 100%; height: 100%; filter: brightness(80%);"
        >
        <img
            class="mySlides"
            src="{{ url_for('static', filename='img/p6.jpeg') }}"
            alt="slideshow7"
            style="width: 100%; height: 100%; filter: brightness(80%);"
        >
        <img
            class="mySlides"
            src="{{ url_for('static', filename='img/p8.png') }}"
            alt="slideshow8"
            style="width: 100%; height: 100%; filter: brightness(80%);"
        >
        <img
            class="mySlides"
            src="{{ url_for('static', filename='img/p9.jpeg') }}"
            alt="slideshow9"
            style="width: 100%; height: 100%; filter: brightness(80%);"
        >
        <img
            class="mySlides"
            src="{{ url_for('static', filename='img/p10.png') }}"
            alt="slideshow10"
            style="width: 100%; height: 100%; filter: brightness(80%);"
        >
    </div>
    <form class="global-search">
        <img class="title-image" src="{{ url_for('static', filename='img/title.png') }}" alt="title2">
        <div class="form-group autocomplete">
            <div style="display: flex;">
                <div>
                    <input
                        id="gn"
                        name="game"
                        class="form-control"
                        placeholder="Enter a game to start"
                        autocomplete="off"
                    >
                    <div id="input_game" class="autocomplete-items"></div>
                </div>
                <button
                    id="go"
                    type="submit"
                    class="btn btn-info"
                    style="margin-left: 15px;"
                >Go!</button>
            </div>
        </div>
    </form>
    <div id="Steam Games" style="border-color: #4285F4;border-width: 5px;">
        <div>
            <h4 style="padding-left: 20px; padding-top: 10px;">Genres:</h4>
            <ul name="genres" id="genres">
                <button class="tag" type="button" value="neutral" name="accounting">Accounting</button>
                <button class="tag" type="button" value="neutral">Action</button>
                <button class="tag" type="button" value="neutral">Adventure</button>
                <button class="tag" type="button" value="neutral">Animation & Modeling</button>
                <button class="tag" type="button" value="neutral">Audio Production</button>
                <button class="tag" type="button" value="neutral">Casual</button>
                <button class="tag" type="button" value="neutral">Design & Illustration</button>
                <button class="tag" type="button" value="neutral">Documentary</button>
                <button class="tag" type="button" value="neutral">Early Access</button>
                <button class="tag" type="button" value="neutral">Education</button>
                <button class="tag" type="button" value="neutral">Free to Play</button>
                <button class="tag" type="button" value="neutral">Game Development</button>
                <button class="tag" type="button" value="neutral">Gore</button>
                <button class="tag" type="button" value="neutral">Indie</button>
                <button class="tag" type="button" value="neutral">Massively Multiplayer</button>
                <button class="tag" type="button" value="neutral">Nudity</button>
                <button class="tag" type="button" value="neutral">Photo Editing</button>
                <button class="tag" type="button" value="neutral">Racing</button>
                <button class="tag" type="button" value="neutral">RPG</button>
                <button class="tag" type="button" value="neutral">Sexual Content</button>
                <button class="tag" type="button" value="neutral">Simulation</button>
                <button class="tag" type="button" value="neutral">Software Training</button>
                <button class="tag" type="button" value="neutral">Sports</button>
                <button class="tag" type="button" value="neutral">Strategy</button>
                <button class="tag" type="button" value="neutral">Tutorial</button>
                <button class="tag" type="button" value="neutral">Utilities</button>
                <button class="tag" type="button" value="neutral">Video Production</button>
                <button class="tag" type="button" value="neutral">Violent</button>
                <button class="tag" type="button" value="neutral">Web Publishing</button>
            </ul>
        </div>
        <br>
        <div id=""></div>
        <button type="button" class="filter" style="margin-left: 20px;">Filter</button>
    </div>
    <div id="output" style="padding-top: 20px;">
        <p style="text-align:center; font-size: large;">
            Showing results for:
            <strong>
                {{ output_message }}
            </strong>
        </p>
    </div>
    <div class="container-fluid results" style="padding-bottom: 75px;">
        <form class="form-inline" style="text-align:center;">
            {% if data != None %}
            {% for d in data %}
            <div class="col-sm-4 overlay-container" style="padding: 5px; position:relative">
                <!-- Being Image of result -->
                <div class="result-box " style="
                display: block;
                height: 160px;
                padding: 50px 0;
                background-size: cover;
                background-position: center;
                background-image: url(
                    {% if gt == 'Video Games' %}
                    {{ d[5] }}
                    {% elif gt == 'Board Games' %}
                    {{ d[2] }}
                    {% endif %}
                );"></div>
                <!-- End Image of result  -->
                <!-- Begin overlay  -->
                <div class="overlay" style="height: 100%;">
                    <div class="result-box-caption">
                        <div class="result-box-caption-content">
                            <!-- Game Name -->
                            <div class="result-text">
                                <p>
                                    <strong>
                                        {% if gt == 'Video Games' %}
                                        {{ d[1] }}

                                        {% else %}
                                        {{ d[0] }}
                                        {% endif %}
                                    </strong>
                                </p>
                            </div>
                            <br>
                            <br>
                            <!-- More info button -->
                            <div class="result-expand">
                                <button type="button" class="modal-btn btn btn-info" id="button">More info</button>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- End overlay  -->
            </div>
            <div class="modal-pop-up modal" id="m-{{loop.index0}}">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">
                                {% if gt == 'Video Games' %}
                          {{ d[1] }}
                          {% else %}
                          {{ d[0] }}
                          {% endif %}
                            </h5>
                            <span class="close" id="close-{{loop.index0}}" style="size=200%;">&times;</span>
                            <!-- <span class="close" id="close-{{loop.index0}}">x</span> -->
                        </div>
                        <div class="modal-body">
                            <img
                                class="modal-img"
                                src="{% if gt == 'Video Games' %}
                              {{ d[5] }}
                              {% elif gt == 'Board Games' %}
                              {{ d[2] }}
                              {% endif %}"
                                alt="game image"
                                style="width:80%"
                            >
                            <p>
                                <a href="
                              {% if gt == 'Video Games' or gt == 'Mobile Games' %}
                              {{ d[6] }}
                              {% elif gt == 'Board Games' %}
                              {{ d[3] }}
                              {% endif %}
                          ">
                                    Click here for more info
                                </a>
                            </p>
                            <p>
                                Similarity Score: {% if gt == 'Video Games'%}
                          {{ d[0] }}
                          {% elif gt == 'Mobile Games' %}
                          {{ d[1] }}
                          {% elif gt == 'Board Games' %}
                          {{ d[1] }}
                          {% endif %}
                            </p>
                            <p>
                                {% if gt == 'Video Games'%}
                          Price: {{ d[4] }}
                          {% elif gt == 'Mobile Games' %}
                          Price: {{ d[2] }}

                          {% endif %}
                            </p>
                            <p>
                                Tags: {% if gt == 'Video Games'%}
                          {{ d[0] }}
                          {% elif gt == 'Mobile Games' %}
                          {{ d[2] }}
                          {% elif gt == 'Board Games' %}
                          {{ d[5] }}
                          {% endif %}
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
            {% endif %}
        </form>
    </div>
    <script>
        $(document).ready(function () {
            // call edit distance function
            async function edDist(gn, gt){
                var res = await $.ajax({
                    url: "/",
                    type: "POST",
                    data: { 'game_name': gn },
                    success: hallelujah
                });
                return res;
            }

            function hallelujah(response) {
                console.log(response)
            }

            // add options to dropdown
            let gn = d3.select('#gn');
            gn.on('input', function(){
                var x = document.getElementById('input_game');
                while (x.lastChild) {
                    x.removeChild(x.lastChild)
                }

                if (document.getElementById('gn').value == '' ||
                    document.getElementById('gn').value == null) { return; }

                edDist(document.getElementById('gn').value)
                    .then(val => {
                        let ans = val.split(';');
                        for (let i = 0; i < 5; i++) {
                            var op = document.createElement('div');
                            op.innerHTML = ans[i];
                            op.setAttribute("style",
                                "padding: 10px; cursor:pointer; background-color: #fff; border-bottom: 1px solid #d4d4d4; width: 100%; text-align: left;")
                            op.addEventListener("click", function(e) {
                                document.getElementById('gn').value = ans[i];
                                while (x.lastChild) {
                                    x.removeChild(x.lastChild)
                                }
                            });
                            x.appendChild(op);
                            console.log(document.getElementById('input_game').lastChild)
                        }
                        console.log(document.getElementById('input_game'))
                        console.log('complete ' + val)
                    });
            });
        });
    </script>
    <script>
        // function get_filters(x){
        //     var f = $(x).find('button').map(function () {
        //         var item = []
        //         if (window.getComputedStyle(this)['backgroundColor'] === "rgb(135, 206, 235)") {
        //             item.push(this.textContent);
        //         }
        //         return item;
        //     });
        //     return f;
        // }

        // $('.filter').click(function(){
        //     let post_data = {
        //         gi: get_filters($('#genres_in')),
        //         ge: get_filters($('#genres_ex')) ,
        //     }
        //     post_data = JSON.stringify(post_data)
        //     $.ajax({
        //         url: window.location.href,
        //         type: 'POST',
        //         contentType: 'application/json',
        //         data: post_data,
        //         dataType: 'json',
        //         success: function(data){
        //             let d = data['data'].replaceAll('[', '').replaceAll(']', '').split(')')
        //             console.log(d)
        //             for (let i = 0; i < d.length; i++) {
        //                 d[i] = d[i].replace('(', '').split(',')
        //                 if (d[i][0] === '') {
        //                     d[i].shift()
        //                 }

        //                 $('.rankings').each(function (j, obj) {
        //                     obj.innerHTML = d[j][1]
        //                 });
        //             }
        //         },
        //         error: function(){
        //             console.log('FAIL')
        //         }
        //     });
        // });


        // $('.tag').each(function(i, obj){
        //     obj.onclick = function(){
        //         console.log(obj.style.backgroundColor.localeCompare('skyblue'))
        //         if (obj.style.backgroundColor.localeCompare('skyblue') === 0){
        //             obj.style.background = '#f0f0f0';
        //         }
        //         else {
        //             obj.style.backgroundColor = 'skyblue';
        //         }
        //     };
        // });

        var filter_btns = document.getElementsByClassName('tag');
        for (let i = 0; i < filter_btns.length; i++) {
            filter_btns[i].onclick = function() {
                if (filter_btns[i].value == "neutral") {
                    filter_btns[i].value = "include"
                    filter_btns[i].style.backgroundColor = "lightblue"
                } else if (filter_btns[i].value == "include") {
                    filter_btns[i].value = "exclude"
                    filter_btns[i].style.backgroundColor = "lightcoral"
                } else {
                    filter_btns[i].value = "neutral"
                    filter_btns[i].style.backgroundColor = "lightgrey"
                }
            }
        }

        // modals
        var modals = document.getElementsByClassName("modal-pop-up");
        var btns = document.getElementsByClassName("modal-btn");
        var spans = document.getElementsByClassName("close");

        console.log(modals)
        console.log(btns)
        console.log(spans)

        for (let i = 0; i < modals.length; i++) {
            btns[i].onclick = function() {
                modals[i].style.display = "block";
            }
            spans[i].onclick = function() {
                modals[i].style.display = "none";
            }
            window.onclick = function(event) {
                if (event.target == modals[i]) {
                    modals[i].style.display = "none";
                }
            }
          }

        // background
        var slideIndex = 0;
        carousel();

        function carousel() {
            var i;
            var x = document.getElementsByClassName("mySlides");
            for (i = 0; i < x.length; i++) {
            x[i].style.display = "none";
            }
            slideIndex++;
            if (slideIndex > x.length) {slideIndex = 1}
            x[slideIndex-1].style.display = "block";
            setTimeout(carousel, 3000); // change image every 2 seconds
        }
    </script>
</html>
