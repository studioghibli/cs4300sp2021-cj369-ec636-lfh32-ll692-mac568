<!DOCTYPE html>
<head>
    <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
    <meta charset="UTF-8">
    <title>Game Recommendations</title>
    <link rel="stylesheet" href="/static/bootstrap.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='main.css') }}">
    <script src="https://d3js.org/d3.v6.min.js"></script>
    <link rel="stylesheet" href="//code.jquery.com/ui/1.8.10/themes/smoothness/jquery-ui.css" type="text/css">
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <!-- <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script> -->
</head>
<body style="padding:0px">
    <div class="navbar navbar-default navbar-fixed-bottom" role="navigation">
        <div class="container">
            <p class="navbar-text">Built by: cj369, ec636, lfh32, ll692, mac568</p>
        </div>
    </div>
    <!-- Slideshow -->
    <div class="slideshow-container" style="padding:0%; position: static;">
        <!-- Full-width images with number and caption text -->
        <img
            class="mySlides"
            src="{{ url_for('static', filename='img/p1.jpeg') }}"
            alt="slideshow2"
            style="width: 100%; height: 100%; filter: brightness(80%);"
        >
        <img
            class="mySlides"
            src="{{ url_for('static', filename='img/p2.jpeg') }}"
            alt="slideshow3"
            style="width: 100%; height: 100%; filter: brightness(80%);"
        >
        <img
            class="mySlides"
            src="{{ url_for('static', filename='img/p3.jpeg') }}"
            alt="slideshow4"
            style="width: 100%; height: 100%; filter: brightness(80%);"
        >
        <img
            class="mySlides"
            src="{{ url_for('static', filename='img/p4.jpeg') }}"
            alt="slideshow5"
            style="width: 100%; height: 100%; filter: brightness(80%);"
        >
        <img
            class="mySlides"
            src="{{ url_for('static', filename='img/p6.jpeg') }}"
            alt="slideshow7"
            style="width: 100%; height: 100%; filter: brightness(80%);"
        >
        <img
            class="mySlides"
            src="{{ url_for('static', filename='img/p8.png') }}"
            alt="slideshow8"
            style="width: 100%; height: 100%; filter: brightness(80%);"
        >
        <img
            class="mySlides"
            src="{{ url_for('static', filename='img/p9.jpeg') }}"
            alt="slideshow9"
            style="width: 100%; height: 100%; filter: brightness(80%);"
        >
        <img
            class="mySlides"
            src="{{ url_for('static', filename='img/p10.png') }}"
            alt="slideshow10"
            style="width: 100%; height: 100%; filter: brightness(80%);"
        >
    </div>
    <form class="global-search" method="GET">
        <img class="title-image" src="{{ url_for('static', filename='img/title.png') }}" alt="title2">
        <div class="form-group autocomplete">
            <div style="display: flex;">
                <div>
                    <input
                        id="gn"
                        name="game"
                        class="form-control"
                        placeholder="Enter a game to start"
                        autocomplete="off"
                    >
                    <div id="input_game" class="autocomplete-items"></div>
                </div>
                <button
                    id="go"
                    type="submit"
                    class="btn btn-info"
                    style="margin-left: 15px;"
                >Go!</button>
            </div>
        </div>
    </form>
    <div id="Video Games" style="border-color: #4285F4;border-width: 5px;">
        <div>
            <h4 style="padding-left: 20px; padding-top: 10px;">Genres:</h4>
            <ul name="genres" id="genres">
                <button class="fil1tag tag" type="button" value="neutral">
                    Accounting
                    <input name="accounting" style="display: none;">
                </button>
                <button class="fil1tag tag" type="button" value="neutral">
                    Action
                    <input name="action" style="display: none;">
                </button>
                <button class="fil1tag tag" type="button" value="neutral">
                    Adventure
                    <input name="adventure" style="display: none;">
                </button>
                <button class="fil1tag tag" type="button" value="neutral">
                    Animation & Modeling
                    <input name="animation-modeling" style="display: none;">
                </button>
                <button class="fil1tag tag" type="button" value="neutral">
                    Audio Production
                    <input name="audio-production" style="display: none;">
                </button>
                <button class="fil1tag tag" type="button" value="neutral">
                    Casual
                    <input name="casual" style="display: none;">
                </button>
                <button class="fil1tag tag" type="button" value="neutral">
                    Design & Illustration
                    <input name="design-illustration" style="display: none;">
                </button>
                <button class="fil1tag tag" type="button" value="neutral">
                    Documentary
                    <input name="documentary" style="display: none;">
                </button>
                <button class="fil1tag tag" type="button" value="neutral">
                    Early Access
                    <input name="early-access" style="display: none;">
                </button>
                <button class="fil1tag tag" type="button" value="neutral">
                    Education
                    <input name="education" style="display: none;">
                </button>
                <button class="fil1tag tag" type="button" value="neutral">
                    Free to Play
                    <input name="free-to-play" style="display: none;">
                </button>
                <button class="fil1tag tag" type="button" value="neutral">
                    Game Development
                    <input name="game-development" style="display: none;">
                </button>
                <button class="fil1tag tag" type="button" value="neutral">
                    Gore
                    <input name="gore" style="display: none;">
                </button>
                <button class="fil1tag tag" type="button" value="neutral">
                    Indie
                    <input name="indie" style="display: none;">
                </button>
                <button class="fil1tag tag" type="button" value="neutral">
                    Massively Multiplayer
                    <input name="massively-multiplayer" style="display: none;">
                </button>
                <button class="fil1tag tag" type="button" value="neutral">
                    Nudity
                    <input name="nudity" style="display: none;">
                </button>
                <button class="fil1tag tag" type="button" value="neutral">
                    Photo Editing
                    <input name="photo-editing" style="display: none;">
                </button>
                <button class="fil1tag tag" type="button" value="neutral">
                    Racing
                    <input name="racing" style="display: none;">
                </button>
                <button class="fil1tag tag" type="button" value="neutral">
                    RPG
                    <input name="rpg" style="display: none;">
                </button>
                <button class="fil1tag tag" type="button" value="neutral">
                    Sexual Content
                    <input name="sexual-content" style="display: none;">
                </button>
                <button class="fil1tag tag" type="button" value="neutral">
                    Simulation
                    <input name="simulation" style="display: none;">
                </button>
                <button class="fil1tag tag" type="button" value="neutral">
                    Software Training
                    <input name="software-training" style="display: none;">
                </button>
                <button class="fil1tag tag" type="button" value="neutral">
                    Sports
                    <input name="sports" style="display: none;">
                </button>
                <button class="fil1tag tag" type="button" value="neutral">
                    Strategy
                    <input name="strategy" style="display: none;">
                </button>
                <button class="fil1tag tag" type="button" value="neutral">
                    Tutorial
                    <input name="tutorial" style="display: none;">
                </button>
                <button class="fil1tag tag" type="button" value="neutral">
                    Utilities
                    <input name="utilities" style="display: none;">
                </button>
                <button class="fil1tag tag" type="button" value="neutral">
                    Video Production
                    <input name="video-production" style="display: none;">
                </button>
                <button class="fil1tag tag" type="button" value="neutral">
                    Violent
                    <input name="violent" style="display: none;">
                </button>
                <button class="fil1tag tag" type="button" value="neutral">
                    Web Publishing
                    <input name="web-publishing" style="display: none;">
                </button>
            </ul>
        </div>
        <br>
        <button
            type="button"
            type="submit"
            class="filter"
            style="margin-left: 20px;"
        >Filter</button>
    </div>
    <div id="output" style="padding-top: 20px;">
        <p style="text-align:center; font-size: large;">
            Showing results for:
            <strong>
                {{ output_message }}
            </strong>
        </p>
    </div>
    <div class="container-fluid results" style="padding-bottom: 75px;">
        <form class="form-inline" style="text-align:center;">
            {% if data != None %}
            {% for d in data %}
            <div class="col-sm-4 overlay-container" style="padding: 5px; position:relative">
                <!-- Being Image of result -->
                <div class="result-box " style="
                display: block;
                height: 160px;
                padding: 50px 0;
                background-size: cover;
                background-position: center;
                background-image: url(
                    {% if gt == 'Video Games' %}
                    {{ d[5] }}
                    {% elif gt == 'Board Games' %}
                    {{ d[2] }}
                    {% endif %}
                );"></div>
                <!-- End Image of result  -->
                <!-- Begin overlay  -->
                <div class="overlay" style="height: 100%;">
                    <div class="result-box-caption">
                        <div class="result-box-caption-content">
                            <!-- Game Name -->
                            <div class="result-text">
                                <p>
                                    <strong>
                                        {% if gt == 'Video Games' %}
                                        {{ d[1] }}
                                        {% else %}
                                        {{ d[0] }}
                                        {% endif %}
                                    </strong>
                                </p>
                            </div>
                            <!-- More info button -->
                            <div class="result-expand">
                                <button type="button" class="modal-btn btn btn-info" id="button">More info</button>
                            </div>
                            <br>
                        </div>
                    </div>
                </div>
                <!-- End overlay  -->
            </div>
            <div class="modal-pop-up modal" id="m-{{loop.index0}}">
                <div class="modal-dialog modal-dialog-centered" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">
                                {% if gt == 'Video Games' %}
                                {{ d[1] }}
                                {% else %}
                                {{ d[0] }}
                                {% endif %}
                            </h5>
                            <span class="close" id="close-{{loop.index0}}" style="size=200%;">&times;</span>
                            <!-- <span class="close" id="close-{{loop.index0}}">x</span> -->
                        </div>
                        <div class="modal-body">
                            <img
                                class="modal-img"
                                src="{% if gt == 'Video Games' %}
                                    {{ d[5] }}
                                    {% elif gt == 'Board Games' %}
                                    {{ d[2] }}
                                    {% endif %}"
                                alt="game image"
                                style="width:80%"
                            >
                            <p>
                                <a href="
                                    {% if gt == 'Video Games' or gt == 'Mobile Games' %}
                                    {{ d[6] }}
                                    {% elif gt == 'Board Games' %}
                                    {{ d[3] }}
                                    {% endif %}
                                ">
                                    Click here for more info
                                </a>
                            </p>
                            <p>
                                Similarity Score: {% if gt == 'Video Games'%}
                                {{ d[0] }}
                                {% elif gt == 'Mobile Games' %}
                                {{ d[1] }}
                                {% elif gt == 'Board Games' %}
                                {{ d[1] }}
                                {% endif %}
                            </p>
                            <p>
                                {% if gt == 'Video Games'%}
                                Price: {{ d[4] }}
                                {% elif gt == 'Mobile Games' %}
                                Price: {{ d[2] }}

                                {% endif %}
                            </p>
                            <p>
                                Tags: {% if gt == 'Video Games'%}
                                {{ d[0] }}
                                {% elif gt == 'Mobile Games' %}
                                {{ d[2] }}
                                {% elif gt == 'Board Games' %}
                                {{ d[5] }}
                                {% endif %}
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
            {% endif %}
        </form>
    </div>
    <script>
        $(document).ready(function () {
            // call edit distance function
            async function edDist(gn){
                var res = await $.ajax({
                    url: "/",
                    type: "POST",
                    data: { 'game_name': gn }
                });
                return res;
            }

            // add options to dropdown
            let gn = d3.select('#gn');
            gn.on('input', function(){
                var x = document.getElementById('input_game');
                while (x.lastChild) {
                    x.removeChild(x.lastChild)
                }

                if (document.getElementById('gn').value == '' ||
                    document.getElementById('gn').value == null) { return; }

                edDist(document.getElementById('gn').value)
                    .then(val => {
                        let ans = val.split(';');
                        for (let i = 0; i < ans.length; i++) {
                            var op = document.createElement('div');
                            op.innerHTML = ans[i];
                            op.setAttribute("style",
                                "padding: 10px; cursor:pointer; background-color: #fff; border-bottom: 1px solid #d4d4d4; width: 100%; text-align: left;")
                            op.addEventListener("click", function(e) {
                                document.getElementById('gn').value = ans[i];
                                while (x.lastChild) {
                                    x.removeChild(x.lastChild)
                                }
                            });
                            x.appendChild(op);
                        }
                    });
            });

            // call boolean
            function boolFilter(gn, f1in, f1out, f2in, f2out, f3in, f3out, f4in, f4out, f5in, f5out){
                var res = await $.ajax({
                    url: "/",
                    type: "POST",
                    data: { 'game_name': gn,
                            'filter_1_in': f1in,
                            'filter_1_out': f1out,
                            'filter_2_in': f2in,
                            'filter_2_out': f2out,
                            'filter_3_in': f3in,
                            'filter_3_out': f3out,
                            'filter_4_in': f4in,
                            'filter_4_out': f4out,
                            'filter_5_in': f5in,
                            'filter_5_out': f5out }
                });
                return res;
            }
            
            let f1in = null;
            let f1out = null;
            let f2in = null;
            let f2out = null;
            let f3in = null;
            let f3out = null;
            let f4in = null;
            let f4out = null;
            let f5in = null;
            let f5out = null;

            if ('{{ gt }}' == "Board Games") {
                let tags1 = document.getElementById('{{ gt }}').getElementsByClassName('fil1tag');
                f1in = [];
                f1out = [];
                for (let i = 0; i < tags1.length; i++ ) {
                    if (tags1[i].value == 'include') {
                        f1in.push(tags1[i].innerHTML);
                    } else if (tags1[i].value == 'exclude') {
                        f1out.push(tags1[i].innerHTML);
                    }
                }

                let tags2 = document.getElementById('{{ gt }}').getElementsByClassName('fil2tag');
                f2in = [];
                f2out = [];
                for (let i = 0; i < tags2.length; i++ ) {
                    if (tags2[i].value == 'include') {
                        f2in.push(tags2[i].innerHTML);
                    } else if (tags2[i].value == 'exclude') {
                        f2out.push(tags2[i].innerHTML);
                    }
                }

                let tags3 = document.getElementById('{{ gt }}').getElementsByClassName('fil3tag');
                f3in = tags3[0].value;
                f3out = tags3[1].value;

                let tags4 = document.getElementById('{{ gt }}').getElementsByClassName('fil4tag');
                f4in = tags4[0].value;
                f4out = tags4[1].value;
            } else if ('{{ gt }}' == "Mobile Games") {
                let tags1 = document.getElementById('{{ gt }}').getElementsByClassName('fil1tag');
                f1in = [];
                f1out = [];
                for (let i = 0; i < tags1.length; i++ ) {
                    if (tags1[i].value == 'include') {
                        f1in.push(tags1[i].innerHTML);
                    } else if (tags1[i].value == 'exclude') {
                        f1out.push(tags1[i].innerHTML);
                    }
                }

                let tags2 = document.getElementById('{{ gt }}').getElementsByClassName('fil2tag');
                f2in = tags2[0].value;
                f2out = tags2[1].value;

                let tags3 = document.getElementById('{{ gt }}').getElementsByClassName('fil3tag');
                f3in = tags3[0].value;
            } else if ('{{ gt }}' == "Video Games") {
                let tags1 = document.getElementById('{{ gt }}').getElementsByClassName('fil1tag');
                f1in = [];
                f1out = [];
                for (let i = 0; i < tags1.length; i++ ) {
                    if (tags1[i].value == 'include') {
                        f1in.push(tags1[i].innerHTML);
                    } else if (tags1[i].value == 'exclude') {
                        f1out.push(tags1[i].innerHTML);
                    }
                }

                let tags2 = document.getElementById('{{ gt }}').getElementsByClassName('fil2tag');
                f2in = [];
                f2out = [];
                for (let i = 0; i < tags2.length; i++ ) {
                    if (tags2[i].value == 'include') {
                        f2in.push(tags2[i].innerHTML);
                    } else if (tags2[i].value == 'exclude') {
                        f2out.push(tags2[i].innerHTML);
                    }
                }

                let tags3 = document.getElementById('{{ gt }}').getElementsByClassName('fil3tag');
                f3in = [];
                f3out = [];
                for (let i = 0; i < tags3.length; i++ ) {
                    if (tags3[i].value == 'include') {
                        f3in.push(tags3[i].innerHTML);
                    } else if (tags3[i].value == 'exclude') {
                        f3out.push(tags3[i].innerHTML);
                    }
                }

                let tags4 = document.getElementById('{{ gt }}').getElementsByClassName('fil4tag');
                f4in = tags4[0].value;
                f4out = tags4[1].value;

                let tags5 = document.getElementById('{{ gt }}').getElementsByClassName('fil5tag');
                f5in = tags5[0].value;
                f5out = tags5[1].value;
            }

            let sub_btn = d3.select('#') // TO-DO: add id to submit filter button
            sub_btn.onclick = function() {
                boolFilter(document.getElementById('gn').value, f1in, f1out, f2in, f2out, f3in, f3out, f4in, f4out, f5in, f5out);
            }
        });
    </script>
    <script>
        var filter_btns = document.getElementsByClassName('tag');
        for (let i = 0; i < filter_btns.length; i++) {
            filter_btns[i].onclick = function() {
                if (filter_btns[i].value == "neutral") {
                    filter_btns[i].value = "include"
                    filter_btns[i].style.backgroundColor = "lightblue"
                } else if (filter_btns[i].value == "include") {
                    filter_btns[i].value = "exclude"
                    filter_btns[i].style.backgroundColor = "lightcoral"
                } else {
                    filter_btns[i].value = "neutral"
                    filter_btns[i].style.backgroundColor = "lightgrey"
                }
            }
        }

        // modals
        var modals = document.getElementsByClassName("modal-pop-up");
        var btns = document.getElementsByClassName("modal-btn");
        var spans = document.getElementsByClassName("close");

        for (let i = 0; i < modals.length; i++) {
            btns[i].onclick = function() {
                modals[i].style.display = "block";
            }
            spans[i].onclick = function() {
                modals[i].style.display = "none";
            }
          }

        // background
        var slideIndex = 0;
        carousel();

        function carousel() {
            var i;
            var x = document.getElementsByClassName("mySlides");
            for (i = 0; i < x.length; i++) {
            x[i].style.display = "none";
            }
            slideIndex++;
            if (slideIndex > x.length) {slideIndex = 1}
            x[slideIndex-1].style.display = "block";
            setTimeout(carousel, 3000); // change image every 2 seconds
        }
    </script>
</html>
